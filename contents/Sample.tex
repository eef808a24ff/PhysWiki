% 本书编写规范

\pentry{本书编写规范\upref{Sample}}
\subsection{软件使用规范}
本书使用 TeXLive2016 软件中的 XeLaTeX 进行编译（暂不兼容更高版本）．如果 Windows 中编译卡在 eu1lmr.fd 上的时间较长，说明 font config 有问题，在 Windows 的控制行运行“fc-cache -fv”，重启 TeXLive，多试几次即可．TeXWork 编辑器中 Ctrl+T 编译，Ctrl+单击跳转到对应的 pdf 或代码，在 pdf 中 Alt+左箭头返回上一个位置． 代码中\textbackslash beq+Tab 生成公式环境，\textbackslash sub+Tab 生成 subsection．Ctrl+F 进行查找，Ctrl+G 查找下一个．菜单中的 Edit>Preference 设置默认字体为 Microsoft YaHei UI（11pt）， 默认编译器为 XeLaTeX，编码选择 UTF-8．

搜索文件夹内所有文档的内容用 FileSeek 软件，搜索空格用“\textbackslash 空格”，搜索“\$”用“\textbackslash \$”，以此类推．对比两个文档或文件夹用 WinMerge 软件．

画图用 Adobe Illustrator， 用知乎的公式编辑器在图中添加公式（把编辑器中的公式另存为 svg 然后在 Illustrator 中打开）\footnote{不推荐的老方法是使用 MathType 添加公式，希腊字母粗体正体矢量用从 Symbol 字体中插入（勾选 bold），更简单的方法是，先输入希腊字母，选中，然后在 Style 里面选 Vector-Matrix}． 图片中的文字必须是 12 号， 如果字太小， 就把图片缩小而不是字放大． 图片中的线条尽量用 1pt 粗细． 图片插入书中后， 图中的字体应比书中的略小． 要画箭头， 先画一条直线， 然后选画笔图标， 在左下角的菜单中选 Arrows>Arrow\_Standard， 选 1.23 号箭头， 再把直线改成 0.3155pt （相当于 1pt 粗的直线）．

\subsection{文件版本管理}
使用 GitHub Desktop， 用 PhysWiki repository管理所有文件， 每次 commit 需要做的事情如下
\begin{itemize}
\item 用 FileSeek 替换所有文档中的空心句号．
\item 确保所有文档可以顺利编译．
\item 解决编译产生的 warning．
\item 检查变化的内容．
\item 把 ManicTime 记录的写作时间记录到“计时.txt”．
\end{itemize}
每次 commit 的标题必须是下列之一
\begin{itemize}
\item 常规更新：包括完善词条，新词条等．
\item 词条统计：统计文件夹，对照表，和书中的词条，查看不一致或缺失．
\item 模板更新：模板有更新．
\item 批量修改：在多个文件中修改某一格式规范， 这种修改比较危险， 需要谨慎．
\end{itemize}
Repository 中创建 “.gitignore” 文件，忽略所有以下后缀名的文件：*.toc， *.aux， *.log， *.out， *synctex.gz．

词条统计的方法： 首先把 contents 文件夹中的所有文件名按顺序排列， 复制到表格中， 然后把词条对照表中的所有标签在表格中找到对应项， 做标记， 并把对照表中的词条名粘贴到表格中． 最后到 PhysWiki.tex 中逐个把标签在表格中找到对应项， 做标记， 对照词条名， 并对照词条文件中第一行的词条名．

\subsection{词条编写规范}

每个词条文件必须有一个独一无二的标签（即使在不同文件夹中）， 词条标签必须限制在 6 个字符内，必须在 PhysWiki.tex， 词条标签对照表和词条文件名中一致． 词条的中文名必须在主文件， 词条标签对照表和词条文件的第一行注释中一致． 如果不是超纲词条， 就把词条放在 contents 目录下， 并在主文件中用 \textbackslash entry \{\}\{\} 命令输入中文名和标签． 超纲词条放在 contents1 目录下并用 \textbackslash Entry \{\}\{\} 命令． 主文件有 Debug.tex， PhysWiki1.tex， 和 PhysWiki.tex 三个， 他们共用一个模板（others 目录）． 新词条必须现在 Debug.tex 中编辑， 完成后再从中删除并将 entry/Entry 插入到 PhysWiki.tex（超纲词条） 或 PhysWiki1.tex 中（力学分册）． Debug.tex 中的 entry/Entry 命令的后面可以用 \textbackslash newpage 命令强制换页， 但不允许在 PhysWiki.tex/PhysWiki1.tex 中这么做．

引用词条用 \textbackslash upref 命令，“预备知识”用 \textbackslash pentry 命令，“应用实例”用 \textbackslash eentry 命令，拓展阅读用 \textbackslash rentry 命令．

\subsubsection{黑色的小标题}

正文必须使用中文的括号，逗号，引号，冒号，分号，问号，感叹号，以及英文的全角实心的句号． 如 “牛顿—莱布尼兹公式” 中的横线必须用中文单破折号． 所有的标点符号前面不能有空格，后面要有空格． 正文\bb{粗体}用 \textbackslash bb， 等效于 \textbackslash textbf． 行内公式用单个美元符号，且两边要有空格，例如 $a^2+b^2=c^2$， 后面有标点符号的除外．方便的办法是先全部使用中文标点，最后再把所有空心句号替换成全角实心句号．

公式的 label 必须要按照“词条标签\_eq编号”的格式，只有需要引用的公式才加标签，编号尽量与显示的编号一致，但原则上不重复即可．图表的标签分别把 eq 改成 fig 和 tab 即可，例题用 ex， 习题用 exe．但凡是有 \textbackslash caption 命令的，\textbackslash label 需要紧接其后． 公式严禁使用 MathType 的自动编码， 必须手打．
\begin{equation}\label{Sample_eq1}
(a+b)^n = \sum_{i=0}^n C_n^i a^i b^{n-i} \quad (n\text{为整数})
\end{equation}
引用公式和图表都统一使用 \textbackslash autoref 命令，注意前面不加空格后面要加空格（后面是标点符号除外）， 例如\autoref{Sample_eq1}． 如果要引用其他词条中的公式，可以引用“其他词条\upref{Sample}”的\autoref{Sample_eq1} 也可以用“\autoref{Sample_eq1}\upref{Sample}”， 为了方便在纸质书上使用， 词条页码是不能忽略的．

\subsection{错别字替换}
正文中常见的错别字如“他们”（它们）， “一下”（以下）， 可以时常搜索替换．

\subsection{公式规范}
公式中的空格从小到大如 $a\, b\; c\quad d\qquad e$， 微分符号如 $\dd{x}$， 注意大括号不可省略． 三点省略号用 $\dots$， 如果要强制在下方， 用 $\ldots$． 大于等于或小于等于必须用 $\les, \ges$ 代替 $\le, \ge$． 自然对数底如 $\E$， 双重极限如
\begin{equation}
\lim_{\substack{\Delta x_i\to 0\\ \Delta y_i\to 0}} \sum_{i, j} f(x_i,y_i) \Delta x_i \Delta y_j
\end{equation}
注意行内公式的 \textbackslash lim 和 \textbackslash sum 如果要在正上方或正下方写东西， 需要加 \textbackslash limits， 如 $\lim\limits_{x\to 0}$．

可变尺寸的小中大括号一律用 Physics 宏包里面的 \textbackslash qty， 如
\begin{equation}
\qty(\frac ab)^2 \qquad \qty[\frac ab]^2 \qquad \qty{ \frac ab}
\end{equation}
对易算符如 $\comm{\Q A}{\Q B}$ 或 $\comm*{\Q A}{\Q B}$， 前者自动尺寸， 后者强制小尺寸． 泊松括号如 $\pb{\frac12}{B}$ 和 $\pb*{\frac12}{B}$．

如果要强制分式立体显示， 用 \textbackslash dfrac 命令， 如果 \textbackslash frac 后面只有两个字符的代码，最好写成如 $\frac12, \frac ab, \frac1a$ 等． 斜分数线后面若多于一个变量需要加括号， 如 $ab/(cd)$． 另外， 常用三角函数和自然指数对数函数后面的小括号（中括号不可以！）会自动改变尺寸（Physics 宏包功能），若要给他们加幂，用中括号
\begin{equation}
\sin(\frac ab) \qquad \sin[2](\frac ab)
\end{equation}
另外可以用自定义的 \textbackslash sinc 函数如 $\sinc x, \sinc(x), \sinc^2(x+y)$，但后面的括号没有自动尺寸．

导数和偏导用 Physics 宏包里面的
\begin{equation}
\dv{x} \quad \dv{f}{x} \quad \dv[2]{f}{x} \quad \dv*[2]{f}{x} \quad
\pdv{x} \quad \pdv{f}{x} \quad \pdv[2]{f}{x} \quad \pdv{f}{x}{y} \quad \pdv*[2]{f}{x}
\end{equation}
复数如 $u+\I v$，复共轭如 $z\Cj$ 实部和虚部如 $\Re[z], \Im[z]$，  行内分式如 $a/b$， 不允许行内用立体分式．公式中的绝对值如 $\abs{a}$， 定积分求值如 $\eval{x^2}_0^1$ （自动尺寸）， 矢量如 $\vec a$， 手写矢量如 $\overrightarrow{a}$， 单位矢量如 $\uvec a$， 矢量点乘如 $\vec A \vdot \vec B$ （不可省略），矢量叉乘如 $\vec A\cross\vec B$． 量子力学算符如 $\Q a$（一般可以不加， 只有必要的时候加）， 矢量量子算符如 $\Qv p$． 狄拉克符号（加 * 号强制小尺寸）如 $\bra{a}, \ket{b}, \braket{a}, \braket{a}{b}, \mel{a}{\Q Q}{b}$． 平均值（加 * 号强制小尺寸）如 $\ev*{\Q Q}, \ev{\Q Q}{\psi}$． 梯度散度旋度拉普拉斯如 $\vec\nabla V$，$\vec\nabla\vdot\vec A$，$\vec\nabla\cross\vec A$，  $\nabla^2 V$， 但最好用 $\grad V$，$\div\vec A$，$\curl\vec A$，  $\laplacian V$． 单独一个粗体的 $\nabla$ 用 $\Nabla$． 行列式，矩阵 $\mat A$，转置 $\mat A \Tr$，厄米共轭 $\mat A \Her$ 如
\begin{equation}
\vmat{1&2\\3&4} \qquad 
\pmat{1&2\\3&4} \qquad 
\pmat{1&2\\3&4}\Tr \qquad
\pmat{1&2\\3&4}\Her
\end{equation}
行内的列矢量用行矢量的转置表示，如 $(1,2,3)\Tr$． 张量如 $\ten T$．

行间公式换行及对齐用 aligned 环境， 或用自定义的 \textbackslash ali 命令， 注意该环境可嵌套．
\begin{equation}\begin{aligned}
(a-b)^2 &= a^2+b^2 - 2ab \\
& = a^2+b^2+2ab-4ab\\
& = (a+b)^2-4ab
\end{aligned}\end{equation}
\begin{equation}\ali{
k_1 &= f(y_n, t_n) 
& k_2 &= f \qty(y_n + h\frac{k_1}{2}, t_n + \frac h2 )\\
k_3 &= f \qty( y_n + h\frac{k_2}{2}, t_n + \frac h2 ) \qquad
& k_4 &= f(y_n + hk_3, t_n + h)
}\end{equation}
左大括号用自定义的 \textbackslash leftgroup 命令， 里面相当于 aligned 环境
\begin{equation}
\leftgroup{
d+e+f&=g\\
a+b&=c}
\end{equation}
可变化尺寸的斜分数线如下
\begin{equation}
\left. \dv[2]{X}{x} \middle/ X + \dv[2]{Y}{y} \middle/ Y + \dv[2]{Z}{z} \middle/ Z  = \frac{1}{c^2}  \dv[2]{T}{t} \middle/ T\right.
\end{equation}
希腊字母如下
\begin{equation}\ali{
&\alpha (a), \beta (b), \chi (c), \delta (d), \epsilon/\varepsilon (e), \phi (f), \gamma (g),
\eta (h), \iota (i), \varphi (j), \kappa (k), \lambda (l), \mu (m),\\
& \nu (n), o (o), \pi (p), \theta (q), \rho (r), \sigma (s), \tau (t), \upsilon (u), \varpi (v), \omega (w), \xi (x), \psi (y), \zeta (z)
}\end{equation}
以下是 script 字母，只有大写有效．所谓大写 $\epsilon$ 其实是花体的 $E$． 
\begin{equation}
\mathcal{A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z}
\end{equation}
另外，电介质常数一律用 $\epsilon$ 而不是 $\varepsilon$．

写单位， 用 \textbackslash Si， 如 $a = 100\Si{m/s^2}$， 这个命令只能出现在公式内（否则 PhysWikiScan 会出 Bug）．

% 由于产生各种混乱，以后一律不用文字环绕图片
%\begin{wrapfigure}{r}{0.36\textwidth}
%\vskip-10pt
%\centering
%\includegraphics[width=0.35\textwidth]{./figures/Sample1.pdf}
%\caption{A gull}
%\vspace{-15pt}
%\end{wrapfigure}

\subsection{图表}

现在来引用一张图片，图片必须以 eps 以及 pdf 两种格式放在 figures 文件夹中， 并生成 svg 格式放在 littleshi.cn/PhysWiki/online 文件夹中． 文件名是词条 label 加图片序号， 即使只有一张图片也要加上 1． 生成 svg 时， 字体一律用 outline， 更多选项中保留 7 位小数， 如果矢量图中包含位图， 要把 Image Location 选成 embed． 代码中使用 pdf 图片．图片宽度一律用 cm 为单位．
\begin{figure}[ht]
\centering
\includegraphics[width=5cm]{./figures/Sample1.pdf}
\caption{例图} \label{Sample_fig1}
\end{figure}
在\autoref{Sample_fig1} 中，label 只能放在 caption 的后面，否则编号会出错．由于图片是浮动的，避免使用“上图”，“下图”等词．

再来看一个表格，如\autoref{Sample_tab1}． 注意标签要放在 caption 后面．
\begin{table}[ht]
\centering
\caption{极限 $\E$ 数值验证}\label{Sample_tab1}
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
$x$ & ${10^{ - 1}}$ & ${10^{ - 2}}$ & ${10^{ - 3}}$ & ${10^{ - 4}}$ & ${10^{ - 5}}$ & ${10^{ - 6}}$ \\
\hline
$(1 + x)^{1/x}$ & 2.59374 & 2.70481 & 2.71692 & 2.71815 & 2.71827 & 2.71828 \\
\hline
\end{tabular}
\end{table}

下面我们举一个例子并引用

\begin{exam}{名称}\label{Sample_ex1}
在例子中，我们的字体可以自定义，包括公式的字号会保持与内容一致．
\begin{equation}
(a+b)^n = \sum_{i=0}^n C_n^i a^i b^{n-i} \quad (n\text{为整数})
\end{equation}
\end{exam}
引用例子同样使用 \textbackslash autoref， 如\autoref{Sample_ex1}． 

下面是一个习题（\autoref{Sample_exe1}）， 除了标题外其他和例子相同
\begin{exer}{名称}\label{Sample_exe1}
已知 $b$ 和 $c$， 求 $a^2 + b^2 = c^2$．
\end{exer}

\subsection{Matlab 代码}
在行内显示少量代码用 \textbackslash x 命令， 如 \x{plot(x,y)}．
\subsubsection{显示  Command Window 中的代码}
注意方括号如果要出现在行首， 必须用大括号括起来， 否则会出错．
\begin{Command}
>> 1.2/3.4 + (5.6+7.8)*9 -1 \\
ans = 119.9529 \\
>> 1/exp(1) \\
ans = 0.3679 \\
>> exp(-1i*pi)+1 \\
ans = 0
\end{Command}

\subsubsection{显示 m 文件中的代码}

代码必须以  .tex 文件格式放在 code 文件夹中的中， 并用 \textbackslash Code（含文件名）或  \textbackslash code （不含文件名）命令导入正文． 较长的 .tex 代码文件必须含文件名， 文件名需要反映代码的内容而不是与词条 label 同名． 对每个 \textbackslash Code 的 .tex 文件， 需要生成同名的 .m 文件（使用 ANSI 编码）． 代码修改测试以 .tex 文件为准， 把变化后的内容粘贴到 .m 文件中． 这些 .m 文件用于上传到网站上提供下载， 以及用于转换成网页． \textbackslash code 导入的文件命名规则与图片命名相同．

如果一个图片的制作使用了代码， 则代码文件必须与图片同名同目录保存． 如果一个词条中的数据用到了一个代码但这个代码却不用出现在书中， 那么这个代码就以图片相同的方式命名并与词条的 .tex 文件保存在同一目录． 

\Code{sample}

\subsection{文献引用}
每章都有一个独立的参考文献列表的词条， 需要在主文件中每章最后一个 \textbackslash entry 后面加入 \textbackslash bibentry 命令插入（见本词条后面）． bibentry 的参数是 bibliographies 文件夹中的文件名， 每个文件与章节导航的 label 同名． 注意全书的词条标签不能有重复． 词条中引用文献格式如\cite{PhysWiki}\cite{PhysWikiEng}．

网址的超链接如\href{http://littleshi.cn}{\color{blue}本书网站}．

\eentry{本书格式规范\upref{Sample}}
\rentry{本书格式规范\upref{Sample}}
