% FEDVR 算法

\pentry{高斯积分（Gauss-Lobatto）} % 链接未完成

\subsection{FEDVR基底}

现在以一维 FEDVR 为例，把整个区间划分成 $N_e$ 个有限元，第 $j$ 个有限元的区间为 $[x_j,x_{j+1}]$．每个有限元内进一步加入格点，令 $x_n^j$ 为第 $j$ 区间的 $N$ 阶 Gauss-Lobatto 数值积分 %链接未完成
的 $N$ 个采样点．这样，$x_1^j=x_j$，  $x_N^j=x_{j+1}$． 把每个有限元的区间作为定义域建立 $N$ 个多项式作为函数基底，第 $j$ 个有限元内的第 $n$ 个基底记为 $u_n^j$， 要求满足
\begin{equation}\label{FEDVR_eq1}
u_n^j(x_{n'}^j) = \delta_{n,n'}
\end{equation}
这样，根据 $N$ 阶 Gauss-Lobatto 数值积分公式
\begin{equation}
\bra{u_n^j}\ket{u_{n'}^j} = \int_{x_j}^{x_{j+1}} u_n^j(x) u_{n'}^j(x) \dd{x} = \frac{x_{j+1}-x_j}{2} \sum_{i=1}^{N} w_i u_n^j(x_i) u_{n'}^j (x_i)
\end{equation}
如果 $u_n^j$ 的阶数都小于等于 $N-1$， 则上式精确成立．把\autoref{FEDVR_eq1} 代入，可得正交关系
\begin{equation}
\bra{u_n^j}\ket{u_{n'}^j} = \delta_{n,n'} \frac{x_{j+1}-x_j}{2} w_n
\end{equation}
在边界 $x_j$ 处，我们要求函数连续但不要求导数连续，于是可以把定义域为 $[x_j,x_{j+1}]$ 的 $u_N^j$  与定义域为 $[x_{j+1},x_{j+2}]$ 的 $u_1^{j+1}$ 合并为一个函数，重新记为 $u_N^j$，放弃符号 $u_1^j$． 另外，对于两个端点 $x_1$ 和 $x_{N_e+1}$， 令边界条件为函数值等于 0， 所以我们放弃 $u_1^1(x)$ 和 $u_N^{N_e}(x)$ 两个基底．这样，我们最终共有 $N_eN-(N_e-1)-2$ 个基底．最广义的正交关系为
\begin{equation}
\bra{u_n^j}\ket{u_{n'}^{j'}} = \delta_{j,j'}\delta{n,n'} \frac{x_{j+1}-x_j}{2}w_n
\end{equation}
这个积分范围可以是 $[x_1, x_{N_e+1}]$． 以下为了方便描述，把每个有限元 $j$ 的区间 $ x\in[x_j,x_{j+1}]$ 均匀映射到 $y\in[-1,1]$ 上
\begin{equation}
y = \frac{x_{j+1}-x_j}{2} x + \frac{x_j+x_{j+1}}{2}
\end{equation}
且定义 $y_i$ 由 $x=x_i^j$ 代入该式得到．我们在所有的有限元中都使用同样的基底，换言之，对于每个 $j$， 每个 $n=2,3\dots N-1$， 在 $x\in[x_j,x_{j+1}]$， 令
\begin{equation}
u_n^j(x) = u_n(y) \qquad y\in[-1,1]
\end{equation}
把剩下的基底 $u_N^j(x)$ 定义为
\begin{equation}
u_N^j(x) = \leftgroup{
&u_N(y) \quad & &x\in[x_j,x_{j+1}] \\
&u_1(y)  & & x\in[x_{j+1},x_{j+2}]
}\end{equation}
现在只要找到 $N$ 个多项式 $u_n(y)$， 就可以找到所有 $u_n^j(x)$ 基底．给 $u_n(y)$ 加上\autoref{FEDVR_eq1} 的条件得
\begin{equation}\label{FEDVR_eq8}
u_n(y_i) = \delta_{n,i}
\end{equation}
满足该式的 $N-1$ 阶多项式可以选用拉格朗日插值公式，即
\begin{equation}\label{FEDVR_eq9}\begin{aligned}
u_n(y) &= \prod_{i=1}^{n-1} \frac{y-y_i}{y_n-y_i} \prod_{i=n+1}^{N} \frac{y-y_i}{y_n-y_i}\\
&= \frac{y-y_1}{y_n-y_1} \times\dots\times\frac{y-y_{n-1}}{y_n-y_{n-1}}\frac{y-y-{n+1}}{y_n-y_{n+1}} \dots \frac{y-y_N}{y_n-y_N}
\end{aligned}\end{equation}
另一种等效的表示方法是利用 $N$ 阶 Gauss-Lobatto 数值积分对应的多项式， $N-1$ 阶勒让德多项式的导数， $P'_{N-1}(y)$，  来构建满足条件的多项式．根据定义，其 $N-2$ 个零点分别为 $y_2, y_3\dots y_{N-1}$， 为了加入 $y_1=-1$ 与 $y_n=1$ 这两个零点，将其变为 $N$ 阶多项式
\begin{equation}\label{FEDVR_eq10}
(1-y^2)P'_{N-1}(y)
\end{equation}
然而，\autoref{FEDVR_eq8} 要求 $u_n(y_n)=1$， 所以我们将\autoref{FEDVR_eq10} 除以它自己在 $y_n$ 处的切线，在 $y=y_n$ 处形成极限类型 $0/0=1$ 即可得到 阶多项式 $u_n(y)$． 
\begin{equation}\label{FEDVR_eq11}
u_n(y) = \frac{(1-y^2)P'_{N-1}(y)}{[(1-y^2)P'_{N-1}(y)]'_y} = y_n (y-y_n)
\end{equation}
该式与式\autoref{FEDVR_eq9} 事实上是完全相同的多项式，因为所有具有 $N-1$ 个零点的 $N-1$ 阶多项式都可以因式分解成\autoref{FEDVR_eq9} 的形式乘以一个待定常数．用\autoref{FEDVR_eq11} 便于快速地展开多项式（因为勒让德多项式的系数可以直接通过公式计算）．

现在知道了所有基底，任意时刻的波函数便可近似展开为
\begin{equation}
\Psi(x,t) = \sum_{j=1}^{N_e-1}\sum_{n=2}^{N} c_n^j(t) u_n^j(x) + \sum_{n=2}^{N-1} c_n^{N_e}(t) u_n^{N_e}(x)
\end{equation}
可以用一个 $N_eN-N_e=1$ 维的列矢量描述波函数
\begin{equation}
\vec\psi = (c_2^1,\dots,c_N^1,\dots,c_2^2,\dots,c_N^2,\dots,c_{N-1}{N_e})\Her
\end{equation}
建立全局下标 $\alpha$， $\beta$， 例如 $\psi_\alpha=c_n^j$ 中 $\alpha=(j-1)(N-1)+(n-1)$． 

\subsection{哈密顿算符}
现在讨论在该基底中如何把哈密顿算符转换成矩阵．
 \begin{equation}\begin{aligned}
H_{\alpha\beta} &= K_{\alpha\beta}+V_{\alpha\beta} \\
&= -\frac{\hbar^2}{2m} \int_{x_1}^{x_{N_e+1}} u_n^j(x)\vdot u_{n'}^{j'}(x)'' \dd{x}
+ \int_{x_1}^{x_{N_e+1}} u_n^j(x) u_{n'}^{j'}(x) V(x) \dd{x}
\end{aligned}\end{equation}
其中
\begin{equation}
V_{\alpha\beta} = \int_{x_1}^{x_{N_e+1}} u_n^j (x) u_{n'}^{j'} (x) V(x) \dd{x} = % 未完成
\end{equation}







